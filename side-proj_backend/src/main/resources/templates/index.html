<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Kamco Data Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #4CAF50; color: white; }
        .controls { margin-bottom: 20px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .message { border-radius: 4px; }
        .message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>Kamco Data Viewer</h1>
    
    <div class="controls">
        <button onclick="loadData('raw')">ì›ë³¸ ë°ì´í„°</button>
        <button onclick="loadData('mnmt')">ë¬¼ê±´ê´€ë¦¬ë²ˆí˜¸ ê¸°ì¤€</button>
        <button onclick="loadData('cltr')">ë¬¼ê±´ëª… ê¸°ì¤€</button>
        <button onclick="loadHistoryData()">ì´ë ¥ ë°ì´í„°</button>
        <form method="post" action="/sample-data" style="display: inline;">
            <button type="submit">ìƒ˜í”Œ ë°ì´í„° ìƒì„±</button>
        </form>
    </div>
    
    <div th:if="${message}" th:class="'message ' + ${messageType}" style="padding: 10px; margin: 10px 0; border-radius: 4px;">
        <span th:text="${message}"></span>
    </div>

    <div id="result">
        <p>ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì„¸ìš”.</p>
    </div>

    <script>
        function loadData(type) {
            const timestamp = new Date().toISOString();
            const url = `/api/kamco/${type}`;
            
            console.log('='.repeat(80));
            console.log(`[${timestamp}] ğŸš€ API ìš”ì²­ ì‹œì‘`);
            console.log(`[${timestamp}] URL: ${url}`);
            console.log(`[${timestamp}] Method: GET`);
            console.log(`[${timestamp}] Type: ${type}`);
            
            const startTime = performance.now();
            
            fetch(url)
                .then(response => {
                    const responseTime = performance.now();
                    console.log(`[${new Date().toISOString()}] âœ… Response received`);
                    console.log(`[${new Date().toISOString()}] Status: ${response.status} ${response.statusText}`);
                    console.log(`[${new Date().toISOString()}] Response Time: ${(responseTime - startTime).toFixed(2)}ms`);
                    console.log(`[${new Date().toISOString()}] Content-Type: ${response.headers.get('content-type')}`);
                    return response.json();
                })
                .then(data => {
                    const endTime = performance.now();
                    console.log(`[${new Date().toISOString()}] ğŸ“¦ Data parsed successfully`);
                    console.log(`[${new Date().toISOString()}] Total Time: ${(endTime - startTime).toFixed(2)}ms`);
                    console.log(`[${new Date().toISOString()}] Result Code: ${data.resultCode}`);
                    console.log(`[${new Date().toISOString()}] Result Message: ${data.resultMsg}`);
                    console.log(`[${new Date().toISOString()}] Items Count: ${data.items ? data.items.length : 0}`);
                    console.log(`[${new Date().toISOString()}] Full Response:`, data);
                    if (data.items && data.items.length > 0) {
                        console.log(`[${new Date().toISOString()}] First Item:`, data.items[0]);
                    }
                    console.log('='.repeat(80));
                    displayData(data);
                })
                .catch(error => {
                    const errorTime = performance.now();
                    console.error('='.repeat(80));
                    console.error(`[${new Date().toISOString()}] âŒ ERROR occurred`);
                    console.error(`[${new Date().toISOString()}] Time: ${(errorTime - startTime).toFixed(2)}ms`);
                    console.error(`[${new Date().toISOString()}] Error Type: ${error.name}`);
                    console.error(`[${new Date().toISOString()}] Error Message: ${error.message}`);
                    console.error(`[${new Date().toISOString()}] Error Stack:`, error.stack);
                    console.error('='.repeat(80));
                    document.getElementById('result').innerHTML = `<p style="color: red;">ì˜¤ë¥˜: ${error.message}</p>`;
                });
        }

        function loadHistoryData() {
            const timestamp = new Date().toISOString();
            const url = '/api/kamco/history';
            
            console.log('='.repeat(80));
            console.log(`[${timestamp}] ğŸš€ ì´ë ¥ ë°ì´í„° ìš”ì²­ ì‹œì‘`);
            console.log(`[${timestamp}] URL: ${url}`);
            
            const startTime = performance.now();
            
            fetch(url)
                .then(response => {
                    const responseTime = performance.now();
                    console.log(`[${new Date().toISOString()}] âœ… Response received`);
                    console.log(`[${new Date().toISOString()}] Status: ${response.status}`);
                    console.log(`[${new Date().toISOString()}] Response Time: ${(responseTime - startTime).toFixed(2)}ms`);
                    return response.json();
                })
                .then(data => {
                    console.log(`[${new Date().toISOString()}] ğŸ“¦ ì´ë ¥ ë°ì´í„°:`, data);
                    displayHistoryData(data);
                })
                .catch(error => {
                    console.error(`[${new Date().toISOString()}] âŒ ì´ë ¥ ë°ì´í„° ì˜¤ë¥˜:`, error);
                    document.getElementById('result').innerHTML = `<p style="color: red;">ì˜¤ë¥˜: ${error.message}</p>`;
                });
        }

        function displayHistoryData(data) {
            const resultDiv = document.getElementById('result');
            
            if (!data.items || data.items.length === 0) {
                resultDiv.innerHTML = '<p>ì¡°íšŒëœ ì´ë ¥ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒ˜í”Œ ë°ì´í„°ë¥¼ ìƒì„±í•´ë³´ì„¸ìš”.</p>';
                return;
            }

            let html = `<p>ì´ë ¥ ë°ì´í„° | ì´ ${data.totalCount}ê±´ (í˜ì´ì§€: ${data.pageNo})</p>`;
            html += '<table><thead><tr>';
            html += '<th>ê³µê³ ë²ˆí˜¸</th><th>ë¬¼ê±´ê´€ë¦¬ë²ˆí˜¸</th><th>ìƒíƒœ</th><th>ìµœì €ì…ì°°ê°€</th><th>ìˆ˜ìˆ˜ë£Œìœ¨</th><th>ê³µê³ ì‹œì‘</th><th>ê³µê³ ì¢…ë£Œ</th><th>ì‘ì°°íšŸìˆ˜</th><th>ì¡°íšŒìˆ˜</th>';
            html += '</tr></thead><tbody>';

            data.items.forEach(item => {
                html += '<tr>';
                html += `<td>${item.PBCT_NO || ''}</td>`;
                html += `<td>${item.CLTR_MNMT_NO || ''}</td>`;
                html += `<td>${item.PBCT_CLTR_STAT_NM || ''}</td>`;
                html += `<td>${item.MIN_BID_PRC ? item.MIN_BID_PRC.toLocaleString() : ''}</td>`;
                html += `<td>${item.FEE_RATE || ''}</td>`;
                html += `<td>${item.PBCT_BEGN_DTM || ''}</td>`;
                html += `<td>${item.PBCT_CLS_DTM || ''}</td>`;
                html += `<td>${item.USCBD_CNT || 0}</td>`;
                html += `<td>${item.IQRY_CNT || 0}</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            resultDiv.innerHTML = html;
        }

        function displayData(data) {
            const resultDiv = document.getElementById('result');
            
            if (!data.items || data.items.length === 0) {
                resultDiv.innerHTML = '<p>ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            let html = `<p>ê²°ê³¼ ì½”ë“œ: ${data.resultCode} | ë©”ì‹œì§€: ${data.resultMsg} | ì´ ${data.items.length}ê±´</p>`;
            html += '<table><thead><tr>';
            html += '<th>ë¬¼ê±´ê´€ë¦¬ë²ˆí˜¸</th><th>ë¬¼ê±´ëª…</th><th>ì²˜ë¶„ë°©ì‹ì½”ë“œ</th><th>ì†Œì¬ì§€</th><th>ê³µê³ ì‹œì‘ì¼</th><th>ê³µê³ ì¢…ë£Œì¼</th>';
            html += '</tr></thead><tbody>';

            data.items.forEach(item => {
                html += '<tr>';
                html += `<td>${item.mnmtNo || ''}</td>`;
                html += `<td>${item.cltrNm || ''}</td>`;
                html += `<td>${item.dpslMtdCd || ''}</td>`;
                html += `<td>${item.nmrdAdrs || ''}</td>`;
                html += `<td>${item.pbctBegnDtm || ''}</td>`;
                html += `<td>${item.pbctEndDtm || ''}</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>
